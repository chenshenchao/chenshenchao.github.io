# [草稿]架构设计

## 项目源码管理

由于现代软件开发完整的功能很难只由一个项目组成，比如前后端分离，或者有队列、中台、微服务等，导致一个功能完整的项目会存在多个子项目。
所以代码管理上就会有以下多种方式。这并不是一个马上就成型的东西，而是一个不断演化改进的过程，不同语言通过扩展开发工具来实现，最常见的就是各种语言工具扩展 workspace 功能。go 加入 work 子命令。rust 的 cargo 也有 workspace 这种功能，可以看到此类语言的仓库往往就是多个子项目在同一个仓库里面的。

- 单仓库 Repo：多个子项目汇总在一个 Git 仓库管理。
- 多仓库 MultiRepo：多个子项目独立的 Git 仓库管理。
- 单仓库共享模块 MonoRepo：多个子项目汇总一个 Git 仓库管理，在此基础上通过改良构建工具共用部分代码、依赖等。

## 序列化与反序列化

序列化和反序列化的格式很多，但是 JSON 占了大头，主要也是因为弱类型语言在这些领域占比大。

- JSON：类型太少。
- BSON：MongoDB 定义的二进制序列化结构，类型比较多。
- Protobuf：GRPC 定义的二进制序列化结构，类型稍微比 JSON 多，但是缺少 Decimal、时间类型等，通过自定义 message 来扩展不够方便。
- MessagePack：二进制序列化结构，库靠第三方维护的多，导致不够稳定好用。

## 常规系统

### 互联网系统

特点：并发多，数据精简，服务人群体量大。

互联网主要是以网站、APP为主的开发，用户都是 C 端的，会主动下载 APP 或者访问网站。
互联网公司的策略都是和宣传紧密相关的，买量更是常态。
大部分的开发也是为了让买量的效益最大化。定位客户人群，不讨好谁，只是让喜欢自己的用户发现自己。
互联网公司非常依赖产品经理的眼光，因为都是自己开发自己的，之后投流获客，所以一个产品的好坏，受众多不多，愿不愿意付费都是靠产品经理。
所以产品经理在互联网公司基本上就是 CEO（乔布斯），游戏公司的话就是主策划（黑神话悟空）。
互联网公司在开发的多是以前没有的东西，所以谁也不知道是什么样，只能听产品经理的。

互联网的服务性能差多半是代码问题，因为互联网公司的设备都是用集群，设备上已经拉满配置。
互联网大厂的单个节点 96核2T内存 组几百台的集群。
互联网小公司会使用 16核32G 左右配置的云服务器，按需购买。

### 企业软件系统

特点：并发少，数据繁杂，服务对象少。

企业系统是在已有业务体系开发系统，业务早就成型，大家都知道这个东西要怎么样。
产品经理地位很低，业务都在各个部分经理手里，员工也有自己的想法，各执己见。
不可能让业务适配软件，所以软件只能适配业务，产品经理成了传声筒，每天都在问各种意见。
一句笑话：“企业系统的产品经理路过门房，大爷都能对他指指点点。”
或许这不是笑话，如果他要开发门禁，大爷确实也有发言权。

企业软件很大程度上就是在管理数据，尤其企业软件管理系统各种定义，总结就是要熟悉企业业务。
这也是为什么程序员主要工作是 CRUD 占多，因为企业业务大多这些。小企业更是 Excel 全包办。

- ERP（Enterprise Resource Planning）企业资源计划：注重管理企业内部。
- CRM（Customer Relationship Management）客户关系管理：注重对企业外部客户关系管理。

为什么会有这么多系统分类呢？因为软件公司不够大，要开发完整的企业系统无法实施，所以都划分区域去实现部分功能。
这属于是软件公司一种取巧的方式，因为开发一整套完整的系统如 SIP 耗费人力巨大。
企业软件的硬件部分，这部分需要操作各种硬件设备，软件开发多是与硬件服务商合作对接。
开发企业软件的公司不会自己生产打印机、门禁、显示屏、排号机（打印机+屏幕）、扫描器等硬件设备，而是通过购买这些设备来对接。
一般会在购买后得到这些设备提供商的 SDK 或者技术支持。
同样还是这个问题，要连硬件也生产的成本太大，所以软件公司取巧了。

企业系统软件卡多半是设备老旧，业务功能随时间累加后老设备性能慢慢被占满，基本上都是单机服务器，设备常常都是十来年的老设备。
一两个 4核8G + 几个 1核1G 的云服务器再买些旧设备就能带动日常 几百人 使用。 

### 电商系统（E-Commerce）

电子商务系统是比较普遍的，几乎每个人都网购过，形形色色的电商系统大同小异。因为是 To C 的，设计上都要让用户简便操作，注重用户习惯，所以都趋同了。

- [newbee mall](https://github.com/newbee-ltd) 电商系统
- [mall 后端](https://github.com/macrozheng/mall) 
- [mall 后台 前端](https://github.com/macrozheng/mall-admin-web)
- [mall APP 前端](https://github.com/macrozheng/mall-app-web)
- [Apache OFBiz](https://ofbiz.apache.org/)
- [nopCommerce](https://github.com/nopSolutions/nopCommerce) 技术栈比较旧，后端 .Net Formatwork 4.8（只能 Windows）；前端用 gulp 打包 jquery 项目。

## 权限

在分布式的架构里，不同服务间就需要鉴权，这就包括以下的方式：

- ACL（Access Control List）访问控制列表：账号的授权和鉴权机制。
- STS（Security Token Service）安全令牌服务：临时账号的生成。

## 数据库

### 链接字段

随着云服务盛行，即便很小的项目文件存储也是分布在云端，所以链接必须是全链接已经毋庸置疑，不然在云端会定位困难或者丢失关键信息。

## 文件

### 对象存储

