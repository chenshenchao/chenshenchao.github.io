import{y as T,r as h,h as B,B as W,b as j,w as y,F as _,C as d,I as P,H as g,G as m,T as N,N as c,u,R as O,D as p,P as V,Q as b,S as k}from"./@vue-70ee5e1b.js";import{u as E}from"./ToolStore-e859fa33.js";import{_ as M}from"./plugin-vueexport-helper-c27b6911.js";import"./pinia-291a7b71.js";import"./lodash-bbb55a89.js";import"./crypto-js-4677913a.js";const S={class:"image-gird"},X={class:"image-row"},Y=["onClick"],z=["src"],F={class:"image-preview"},D=["src"],Q=T({__name:"ImageGirdPage",setup(q){const f=h(),G=h(),t=E(),n=B({cells:[],cellX:void 0,cellY:void 0}),U=(l,e)=>{const o=n.cells[e];return o?o[l]:null},C=(l,e)=>{var o,i,r,a;(i=(o=f.value)==null?void 0:o.$el)==null||i.style.setProperty("--cell-width",`${l}px`),(a=(r=f.value)==null?void 0:r.$el)==null||a.style.setProperty("--cell-height",`${e}px`)},v=(l,e)=>{const o=[];for(let i=0;i<l;++i){const r=[];for(let a=0;a<e;++a)r.push(U(a,i));o.push(r)}n.cells=o};W(()=>{v(t.imageGird.rowCount,t.imageGird.columnCount)}),j(()=>{C(t.imageGird.imageWidth,t.imageGird.imageHeight)}),y(()=>[t.imageGird.rowCount,t.imageGird.columnCount],([l,e])=>{v(l,e)}),y(()=>[t.imageGird.imageWidth,t.imageGird.imageHeight],([l,e])=>{C(l,e)});const x=(l,e)=>{var o;n.cellX=l,n.cellY=e,(o=G.value)==null||o.click()},I=()=>{const l=document.createElement("canvas");l.width=t.imageGird.imageWidth*t.imageGird.columnCount,l.height=t.imageGird.imageHeight*t.imageGird.rowCount;const e=l.getContext("2d");for(let o=0;o<t.imageGird.rowCount;++o)for(let i=0;i<t.imageGird.columnCount;++i){const r=n.cells[o][i];if(r){const a=document.createElement("img");a.src=r,e==null||e.drawImage(a,0,0,a.width,a.height,i*t.imageGird.imageWidth,o*t.imageGird.imageHeight,t.imageGird.imageWidth,t.imageGird.imageHeight)}}l.toBlob(o=>{n.imageTarget&&URL.revokeObjectURL(n.imageTarget),n.imageTarget=URL.createObjectURL(o)},"image/png",.9)},L=l=>{const e=l.target,o=e.files[0],i=n.cellX??0,r=n.cellY??0,a=n.cells[r][i];e.value="",a&&URL.revokeObjectURL(a),n.cells[r][i]=URL.createObjectURL(o)};return(l,e)=>{const o=_("pc-form-number-input"),i=_("pc-form-row"),r=_("pc-form-text-button"),a=_("pc-form-sheet"),R=_("pc-center-part-layout");return d(),P(R,{ref_key:"$el",ref:f,class:"pc-image-gird-page"},{default:g(()=>[m(a,{class:"image-info-pane",onSubmit:e[4]||(e[4]=N(()=>{},["prevent"]))},{default:g(()=>[m(i,null,{default:g(()=>[e[5]||(e[5]=c("label",null,"行数：",-1)),m(o,{modelValue:u(t).imageGird.rowCount,"onUpdate:modelValue":e[0]||(e[0]=s=>u(t).imageGird.rowCount=s),precision:0},null,8,["modelValue"]),e[6]||(e[6]=c("label",null,"列数：",-1)),m(o,{modelValue:u(t).imageGird.columnCount,"onUpdate:modelValue":e[1]||(e[1]=s=>u(t).imageGird.columnCount=s),precision:0},null,8,["modelValue"])]),_:1}),m(i,null,{default:g(()=>[e[7]||(e[7]=c("label",null,"宽：",-1)),m(o,{modelValue:u(t).imageGird.imageWidth,"onUpdate:modelValue":e[2]||(e[2]=s=>u(t).imageGird.imageWidth=s),precision:0},null,8,["modelValue"]),e[8]||(e[8]=c("label",null,"长：",-1)),m(o,{modelValue:u(t).imageGird.imageHeight,"onUpdate:modelValue":e[3]||(e[3]=s=>u(t).imageGird.imageHeight=s),precision:0},null,8,["modelValue"])]),_:1}),m(i,null,{default:g(()=>[m(r,{onClick:I},{default:g(()=>e[9]||(e[9]=[O("生成")])),_:1})]),_:1})]),_:1}),c("div",S,[(d(!0),p(V,null,b(n.cells,(s,$)=>(d(),p("div",X,[(d(!0),p(V,null,b(s,(w,H)=>(d(),p("div",{class:"image-cell",onClick:A=>x(H,$)},[w?(d(),p("img",{key:0,src:w},null,8,z)):k("",!0)],8,Y))),256))]))),256)),c("input",{ref_key:"$cellInput",ref:G,accept:"image/*",type:"file",onInput:L,style:{display:"none"}},null,544)]),c("div",F,[n.imageTarget?(d(),p("img",{key:0,class:"image-target",alt:"target",src:n.imageTarget},null,8,D)):k("",!0)])]),_:1},512)}}});const le=M(Q,[["__scopeId","data-v-203a2006"]]);export{le as default};
